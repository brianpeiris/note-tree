var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(e,t){e.appendChild(t)}function i(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode.removeChild(e)}function c(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function u(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function f(){return d(" ")}function h(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function p(e,t,n){e.classList[n?"add":"remove"](t)}let g;function b(e){g=e}function $(){if(!g)throw new Error("Function called outside component initialization");return g}function v(e){$().$$.on_mount.push(e)}function x(e){$().$$.after_update.push(e)}const k=[],w=[],y=[],S=[],E=Promise.resolve();let _=!1;function O(e){y.push(e)}let I=!1;const T=new Set;function C(){if(!I){I=!0;do{for(let e=0;e<k.length;e+=1){const t=k[e];b(t),A(t.$$)}for(b(null),k.length=0;w.length;)w.pop()();for(let e=0;e<y.length;e+=1){const t=y[e];T.has(t)||(T.add(t),t())}y.length=0}while(k.length);for(;S.length;)S.pop()();_=!1,I=!1,T.clear()}}function A(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(O)}}const j=new Set;let N;function W(){N={r:0,c:[],p:N}}function B(){N.r||r(N.c),N=N.p}function z(e,t){e&&e.i&&(j.delete(e),e.i(t))}function J(e,t,n,r){if(e&&e.o){if(j.has(e))return;j.add(e),N.c.push((()=>{j.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}function K(e){e&&e.c()}function L(e,n,l,s){const{fragment:i,on_mount:a,on_destroy:c,after_update:u}=e.$$;i&&i.m(n,l),s||O((()=>{const n=a.map(t).filter(o);c?c.push(...n):r(n),e.$$.on_mount=[]})),u.forEach(O)}function M(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function D(e,t){-1===e.$$.dirty[0]&&(k.push(e),_||(_=!0,E.then(C)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function q(t,o,l,s,i,c,u=[-1]){const d=g;b(t);const f=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:i,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:o.context||[]),callbacks:n(),dirty:u,skip_bound:!1};let h=!1;if(f.ctx=l?l(t,o.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&i(f.ctx[e],f.ctx[e]=o)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](o),h&&D(t,e)),n})):[],f.update(),h=!0,r(f.before_update),f.fragment=!!s&&s(f.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);f.fragment&&f.fragment.l(e),e.forEach(a)}else f.fragment&&f.fragment.c();o.intro&&z(t.$$.fragment),L(t,o.target,o.anchor,o.customElement),C()}b(d)}class F{$destroy(){M(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function P(e,t,n){const r=Array.from(e.matchAll(t)).filter((e=>e.index>n));return r&&r.length?r[0].index:null}function R(){const e="abcdefghijkmnpqrstwxyz234789";return Array.from({length:8}).map((t=>e[Math.floor(Math.random()*e.length)])).join("")}const U={normal:Symbol.for("normal"),insert:Symbol.for("insert")};function G(e,t,n){const r=e.slice();return r[9]=t[n],r[10]=t,r[11]=n,r}function H(e){let t,n,r=e[9];const o=()=>e[8](t,r),l=()=>e[8](null,r);let s={mode:e[3],focusedId:e[4],item:e[9],noteEls:e[1]};return t=new X({props:s}),o(),{c(){K(t.$$.fragment)},m(e,r){L(t,e,r),n=!0},p(e,n){r!==e[9]&&(l(),r=e[9],o());const s={};8&n&&(s.mode=e[3]),16&n&&(s.focusedId=e[4]),1&n&&(s.item=e[9]),2&n&&(s.noteEls=e[1]),t.$set(s)},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){l(),M(t,e)}}}function Q(e){let t,n,r,o,l,d,g,b,$,v=e[0].children,x=[];for(let t=0;t<v.length;t+=1)x[t]=H(G(e,v,t));const k=e=>J(x[e],1,1,(()=>{x[e]=null}));return{c(){t=u("div"),n=u("input"),o=f(),l=u("div");for(let e=0;e<x.length;e+=1)x[e].c();n.value=r=e[0].content,m(n,"class","svelte-1e6xa6n"),p(n,"focused",e[0].id===e[4]),p(n,"normal",e[3]===U.normal),p(n,"insert",e[3]===U.insert),m(l,"class","children svelte-1e6xa6n"),m(t,"id",d=e[0].id)},m(r,a){i(r,t,a),s(t,n),e[6](n),s(t,o),s(t,l);for(let e=0;e<x.length;e+=1)x[e].m(l,null);g=!0,b||($=h(n,"input",e[7]),b=!0)},p(e,[o]){if((!g||1&o&&r!==(r=e[0].content)&&n.value!==r)&&(n.value=r),17&o&&p(n,"focused",e[0].id===e[4]),8&o&&p(n,"normal",e[3]===U.normal),8&o&&p(n,"insert",e[3]===U.insert),27&o){let t;for(v=e[0].children,t=0;t<v.length;t+=1){const n=G(e,v,t);x[t]?(x[t].p(n,o),z(x[t],1)):(x[t]=H(n),x[t].c(),z(x[t],1),x[t].m(l,null))}for(W(),t=v.length;t<x.length;t+=1)k(t);B()}(!g||1&o&&d!==(d=e[0].id))&&m(t,"id",d)},i(e){if(!g){for(let e=0;e<v.length;e+=1)z(x[e]);g=!0}},o(e){x=x.filter(Boolean);for(let e=0;e<x.length;e+=1)J(x[e]);g=!1},d(n){n&&a(t),e[6](null),c(x,n),b=!1,$()}}}function V(e,t,n){let{item:r=null}=t,{mode:o=null}=t,{focusedId:l=null}=t,{noteEls:s=null}=t,{textarea:i=null}=t;function a(e){n(0,r.content=e,r)}v((()=>{})),x((()=>{l===r.id&&i.focus(),"selectionStart"in r&&(n(2,i.selectionStart=n(2,i.selectionEnd=r.selectionStart,i),i),delete r.selectionStart)}));return e.$$set=e=>{"item"in e&&n(0,r=e.item),"mode"in e&&n(3,o=e.mode),"focusedId"in e&&n(4,l=e.focusedId),"noteEls"in e&&n(1,s=e.noteEls),"textarea"in e&&n(2,i=e.textarea)},[r,s,i,o,l,a,function(e){w[e?"unshift":"push"]((()=>{i=e,n(2,i)}))},e=>a(e.target.value),function(e,t){w[e?"unshift":"push"]((()=>{s[t.id]=e,n(1,s),n(0,r)}))}]}class X extends F{constructor(e){var t;super(),document.getElementById("svelte-1e6xa6n-style")||((t=u("style")).id="svelte-1e6xa6n-style",t.textContent=".children.svelte-1e6xa6n{margin-left:20px}input.svelte-1e6xa6n{display:block;width:100%}input.focused.normal.svelte-1e6xa6n{color:#0000d5}input.focused.insert.svelte-1e6xa6n{color:darkgreen}",s(document.head,t)),q(this,e,V,Q,l,{item:0,mode:3,focusedId:4,noteEls:1,textarea:2})}get item(){return this.$$.ctx[0]}set item(e){this.$set({item:e}),C()}get mode(){return this.$$.ctx[3]}set mode(e){this.$set({mode:e}),C()}get focusedId(){return this.$$.ctx[4]}set focusedId(e){this.$set({focusedId:e}),C()}get noteEls(){return this.$$.ctx[1]}set noteEls(e){this.$set({noteEls:e}),C()}get textarea(){return this.$$.ctx[2]}set textarea(e){this.$set({textarea:e}),C()}}function Y(e,t,n){const r=e.slice();return r[10]=t[n],r[11]=t,r[12]=n,r}function Z(e,t,n){const r=e.slice();return r[13]=t[n],r[12]=n,r}function ee(e){let t;return{c(){t=d(">")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function te(e){let t,n,r,o,l=e[13].content+"",c=e[12]!==e[1].length-1&&ee();return{c(){t=u("a"),n=d(l),c&&c.c(),o=d(""),m(t,"href",r="?id="+e[13].id),m(t,"class","svelte-hwrn63")},m(e,r){i(e,t,r),s(t,n),c&&c.m(e,r),i(e,o,r)},p(e,s){2&s&&l!==(l=e[13].content+"")&&function(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}(n,l),2&s&&r!==(r="?id="+e[13].id)&&m(t,"href",r),e[12]!==e[1].length-1?c||(c=ee(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(e){e&&a(t),c&&c.d(e),e&&a(o)}}}function ne(e){let t,n,r=e[10];const o=()=>e[7](t,r),l=()=>e[7](null,r);let s={mode:e[2],focusedId:e[3].id,item:e[10],noteEls:e[4]};return t=new X({props:s}),o(),{c(){K(t.$$.fragment)},m(e,r){L(t,e,r),n=!0},p(e,n){r!==e[10]&&(l(),r=e[10],o());const s={};4&n&&(s.mode=e[2]),8&n&&(s.focusedId=e[3].id),1&n&&(s.item=e[10]),16&n&&(s.noteEls=e[4]),t.$set(s)},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){l(),M(t,e)}}}function re(e){let t,n,r,o,l,g,b,$,v,x,k,w=e[1],y=[];for(let t=0;t<w.length;t+=1)y[t]=te(Z(e,w,t));let S=e[0],E=[];for(let t=0;t<S.length;t+=1)E[t]=ne(Y(e,S,t));const _=e=>J(E[e],1,1,(()=>{E[e]=null}));return{c(){t=u("main"),n=u("div"),r=u("a"),r.textContent="root",o=d(">");for(let e=0;e<y.length;e+=1)y[e].c();l=f(),g=u("div"),b=f(),$=u("div");for(let e=0;e<E.length;e+=1)E[e].c();m(r,"href","."),m(r,"class","svelte-hwrn63"),m(n,"class","path svelte-hwrn63"),m(g,"class","mode svelte-hwrn63"),p(g,"normal",e[2]===U.normal),p(g,"insert",e[2]===U.insert),m($,"class","items svelte-hwrn63"),m(t,"class","svelte-hwrn63")},m(a,c){i(a,t,c),s(t,n),s(n,r),s(n,o);for(let e=0;e<y.length;e+=1)y[e].m(n,null);s(t,l),s(t,g),s(t,b),s(t,$);for(let e=0;e<E.length;e+=1)E[e].m($,null);v=!0,x||(k=h($,"keydown",e[5]),x=!0)},p(e,[t]){if(2&t){let r;for(w=e[1],r=0;r<w.length;r+=1){const o=Z(e,w,r);y[r]?y[r].p(o,t):(y[r]=te(o),y[r].c(),y[r].m(n,null))}for(;r<y.length;r+=1)y[r].d(1);y.length=w.length}if(4&t&&p(g,"normal",e[2]===U.normal),4&t&&p(g,"insert",e[2]===U.insert),29&t){let n;for(S=e[0],n=0;n<S.length;n+=1){const r=Y(e,S,n);E[n]?(E[n].p(r,t),z(E[n],1)):(E[n]=ne(r),E[n].c(),z(E[n],1),E[n].m($,null))}for(W(),n=S.length;n<E.length;n+=1)_(n);B()}},i(e){if(!v){for(let e=0;e<S.length;e+=1)z(E[e]);v=!0}},o(e){E=E.filter(Boolean);for(let e=0;e<E.length;e+=1)J(E[e]);v=!1},d(e){e&&a(t),c(y,e),c(E,e),x=!1,k()}}}function oe(e){return e.map((e=>{const t={...e};return delete t.parent,delete t.arr,t.children=oe(t.children),t}))}function le(e,t,n){let{full:r=null}=t,{items:o=null}=t,{path:l=null}=t,s=U.normal,i=o[0],a={},c=null;const u={moveTo(e,t){e.selectionStart=e.selectionEnd=t},start:e=>{u.moveTo(e,0)},end:e=>{u.moveTo(e,e.value.length)},lastChar:e=>{u.moveTo(e,e.value.length-1)},firstChar:e=>{const t=e.value.match(/\S/);t&&u.moveTo(e,t.index)},back:e=>{u.moveTo(e,e.selectionStart-1)},forward:e=>{u.moveTo(e,e.selectionStart+1)},forwardWord:e=>{const t=P(e.value,/\s\b/g,e.selectionStart);null!==t&&u.moveTo(e,t+1)},endWord:e=>{const t=P(e.value,/\b\s/g,e.selectionStart+1);null!==t?u.moveTo(e,t-1):u.moveTo(e,e.value.length-1)},backWord:e=>{const t=function(e,t,n){const r=Array.from(e.matchAll(t)).reverse().filter((e=>e.index<n));return r&&r.length?r[0].index:null}(e.value,/\s\b/g,e.selectionStart-1);null!==t?u.moveTo(e,t+1):u.moveTo(e,0)}};return v((()=>{})),x((()=>{})),e.$$set=e=>{"full"in e&&n(6,r=e.full),"items"in e&&n(0,o=e.items),"path"in e&&n(1,l=e.path)},[o,l,s,i,a,function(e){if(s===U.normal){let t=!0;const r=a[i.id].textarea;switch(c||e.key){case"j":if(i.children.length)n(3,i=i.children[0]);else{const e=i.arr.indexOf(i);if(e===i.arr.length-1){if(i.parent){let e,t=i;do{if(t=t.parent,!t)break;e=t.arr[t.arr.indexOf(t)+1]}while(!e);e&&n(3,i=e)}}else n(3,i=i.arr[e+1])}break;case"J":{const e=i.arr,t=e.indexOf(i);if(t===e.length-1)break;const r=i;e[t]=e[t+1],e[t+1]=r,n(0,o)}break;case"k":{const e=i.arr.indexOf(i);if(0===e)i.parent&&n(3,i=i.parent);else{const t=i.arr[e-1];if(t&&t.children.length){let e=t;do{e=e.children[e.children.length-1]}while(e.children.length);n(3,i=e)}else n(3,i=t)}}break;case"K":{const e=i.arr,t=e.indexOf(i);if(0===t)break;const r=i;e[t]=e[t-1],e[t-1]=r,n(0,o)}break;case"O":{const t={id:R(),content:"",arr:i.arr,parent:i.parent,children:[]};i.arr.splice(i.arr.indexOf(i),0,t),n(3,i=t),e.altKey||n(2,s=U.insert),n(0,o)}break;case"o":{const t={id:R(),content:"",arr:i.arr,parent:i.parent,children:[]};i.arr.splice(i.arr.indexOf(i)+1,0,t),n(3,i=t),e.altKey||n(2,s=U.insert),n(0,o)}break;case"^":u.firstChar(r);break;case"0":u.moveTo(r,0);break;case"$":u.lastChar(r);break;case"b":u.backWord(r);break;case"w":u.forwardWord(r);break;case"e":u.endWord(r);break;case"h":u.back(r);break;case"l":u.forward(r);break;case"x":{const{selectionStart:e}=r;n(3,i.content=i.content.substring(0,e)+i.content.substring(e+1),i),n(3,i.selectionStart=e,i),n(0,o)}break;case"s":{const{selectionStart:e}=r;n(3,i.content=i.content.substring(0,e)+i.content.substring(e+1),i),n(3,i.selectionStart=e,i),n(2,s=U.insert),n(0,o)}break;case"C":n(3,i.content=i.content.substring(0,r.selectionStart),i),n(2,s=U.insert),n(0,o);break;case"D":n(3,i.content=i.content.substring(0,r.selectionStart),i),n(0,o);break;case"i":n(2,s=U.insert);break;case"I":u.firstChar(r),n(2,s=U.insert);break;case"a":u.forward(r),n(2,s=U.insert);break;case"A":u.end(r),n(2,s=U.insert);break;case"f":i.parent&&(location.href=`?id=${i.parent.id}`);break;case"u":location.href=l.length<2?".":`?id=${l.slice(-2)[0].id}`;break;case"g":if(!c){c="g";break}"g"===e.key&&n(3,i=o[0]),c=null;break;case">":{if(!c){c=">";break}const e=i.arr.indexOf(i);if(0!==e){i.arr.splice(e,1);const t=i.arr[e-1];t.children.push(i),n(3,i.arr=t.children,i),n(3,i.parent=t,i),n(0,o)}c=null}break;case"<":{if(!c){c="<";break}const e=i.arr.indexOf(i);i.arr.splice(e,1);const t=i.parent.arr,r=t.indexOf(i.parent);t.splice(r+1,0,i),n(3,i.arr=t,i),n(3,i.parent=i.parent.parent,i),n(0,o),c=null}break;case"d":{if(!c){c="d";break}const e=i.arr,t=e.indexOf(i);(i.parent||1!==e.length)&&(e.splice(t,1),e.length?n(3,i=e[Math.min(e.length-1,t)]):n(3,i=i.parent),n(0,o)),c=null}break;case"F5":t=!1}t&&e.preventDefault()}else if(s===U.insert)switch(e.key){case"[":e.ctrlKey&&(e.preventDefault(),n(2,s=U.normal))}localStorage.setItem("items",JSON.stringify(oe(r),null,2))},r,function(e,t){w[e?"unshift":"push"]((()=>{a[t.id]=e,n(4,a),n(0,o)}))}]}let se;se=localStorage.getItem("items")?localStorage.getItem("items"):JSON.stringify([{id:R(),content:"",children:[]}]);const ie=JSON.parse(se),ae=new URLSearchParams(location.search).get("id");let ce;ae&&(ce=function e(t,n,r){for(const o of t){if(o.id===n)return{items:o.children,path:r.concat(o)};if(o.children.length){const t=e(o.children,n,r.concat(o));if(t)return t}}}(ie,ae,[]));return new class extends F{constructor(e){var t;super(),document.getElementById("svelte-hwrn63-style")||((t=u("style")).id="svelte-hwrn63-style",t.textContent="*{box-sizing:border-box}body{display:flex;justify-content:center;font-family:sans-serif}input{font-family:inherit;font-size:inherit;padding:0.4em;margin-bottom:0.5em;border:1px solid #ccc;border-radius:2px}main.svelte-hwrn63.svelte-hwrn63{display:grid;grid-template:auto / 20px auto}.path.svelte-hwrn63.svelte-hwrn63{padding:0.5em;grid-column:span 2}.path.svelte-hwrn63 a.svelte-hwrn63{padding:0 5px}.items.svelte-hwrn63.svelte-hwrn63{width:min(80vw, 500px)}.mode.svelte-hwrn63.svelte-hwrn63{width:10px;margin-right:10px}.mode.normal.svelte-hwrn63.svelte-hwrn63{background:lightblue}.mode.insert.svelte-hwrn63.svelte-hwrn63{background:lightgreen}",s(document.head,t)),q(this,e,le,re,l,{full:6,items:0,path:1})}}({target:document.body,props:{path:ce&&ce.path||[],full:ie,items:function e(t,n){for(const r of t)r.parent=n,r.arr=t,r.children&&r.children.length&&e(r.children,r);return t}(ce&&ce.items||ie)}})}();
//# sourceMappingURL=main-e8b41950.js.map
